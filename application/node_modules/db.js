const {Pool} = require('pg')
const connectionString = 'postgresql://postgres:toor@localhost:5432/postgres'

const pool = new Pool({
  connectionString: connectionString,
});

exports.userPassAuth = function(username, password, callback){
  var selectUser = 'SELECT * from teste where username = \''+username+'\';';
  var selectUserPass = 'SELECT * from teste where username = \''+username+'\' and password = \''+password+'\';';
  pool.query(selectUser, function(err, res) {
    if (err){
      return callback(err)
    }else if(res.rows.length==0){
      return callback(null, false ,{message:"Usuário não existe."});
      // callback(null, false, req.flash('loginMessage', 'Pas d\'utilisateur avec ce login.'));

    }else{
      pool.query(selectUserPass, function(err, res){
        if(err){
          return callback(err);
        }else if(res.rows.length==0){
          callback(null, false, {message:"Senha incorreta."});
          // callback(null, false, req.flash('loginMessage', 'Pas d\'utilisateur avec ce login.'));

        }else{
          callback(null, res.rows[0], {message: "Login efetuado com sucesso!"});
        }
      });
    }
  });
}

exports.findUserById = function(id, callback){
  console.log("id Enviado para a função = "+id)
  var select = 'Select * from teste where id = '+id+';';
  pool.query(select, function(err, res){
    if(err){
      console.log("deuRuim")
      console.log(err)
      callback(err, null);
    }else{
      console.log("DeuBão")
      console.log(res.rows[0])
      callback(null, res.rows[0]);
    }
  })
}
